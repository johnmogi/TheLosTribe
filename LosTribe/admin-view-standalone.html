<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LosTribe - Backstage Generator Admin View</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1, h2, h3 {
            color: #64b5f6;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #64b5f6;
            padding-bottom: 20px;
        }

        .run-summary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #64b5f6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: rgba(100, 181, 246, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-card h3 {
            color: #81c784;
            font-size: 2em;
            margin-bottom: 5px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #64b5f6;
        }

        .tab-btn {
            background: none;
            border: none;
            color: #e0e0e0;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .tab-btn:hover {
            background: rgba(100, 181, 246, 0.1);
        }

        .tab-btn.active {
            color: #64b5f6;
            border-bottom-color: #64b5f6;
            background: rgba(100, 181, 246, 0.1);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #64b5f6;
            border-radius: 10px;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .hero-card, .monster-card, .room-card, .treasure-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid #81c784;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .monster-card {
            border-color: #e57373;
        }

        .treasure-card {
            border-color: #ffb74d;
        }

        .room-card {
            border-color: #64b5f6;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .card-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .card-badge {
            background: rgba(100, 181, 246, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #bdbdbd;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #81c784;
        }

        .loot-list {
            margin-top: 10px;
        }

        .loot-item {
            background: rgba(255, 181, 77, 0.1);
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }

        .loot-name {
            color: #ffb74d;
        }

        .loot-value {
            color: #81c784;
        }

        .floor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .floor-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #64b5f6;
            border-radius: 10px;
            padding: 15px;
        }

        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .mini-room {
            background: rgba(100, 181, 246, 0.1);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.8em;
        }

        .controls {
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            background: #64b5f6;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #42a5f5;
            transform: translateY(-2px);
        }

        .evolution-timeline {
            background: rgba(129, 199, 132, 0.1);
            border: 1px solid #81c784;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .timeline-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border-left: 3px solid #81c784;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #64b5f6;
            border-radius: 5px;
            color: #e0e0e0;
        }

        .search-box::placeholder {
            color: #bdbdbd;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .run-summary {
                grid-template-columns: 1fr;
            }

            .floor-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÆ LosTribe Backstage Generator</h1>

        <div class="controls">
            <button onclick="generateNewRun()">üé≠ Generate New Run</button>
            <button onclick="toggleView('hero')">üë§ Hero</button>
            <button onclick="toggleView('dungeon')">üè∞ Dungeon</button>
            <button onclick="toggleView('encounters')">‚öîÔ∏è Encounters</button>
            <button onclick="toggleView('treasures')">üíé Treasures</button>
            <button onclick="toggleView('events')">üé≠ Events</button>
            <button onclick="toggleView('evolution')">üå± Evolution</button>
        </div>

        <div id="run-summary" class="run-summary">
            <div class="summary-card">
                <h3 id="hero-name">-</h3>
                <div>Hero</div>
            </div>
            <div class="summary-card">
                <h3 id="total-floors">-</h3>
                <div>Floors</div>
            </div>
            <div class="summary-card">
                <h3 id="total-rooms">-</h3>
                <div>Rooms</div>
            </div>
            <div class="summary-card">
                <h3 id="total-monsters">-</h3>
                <div>Monsters</div>
            </div>
            <div class="summary-card">
                <h3 id="total-treasures">-</h3>
                <div>Treasures</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('hero')">üë§ Hero Details</button>
            <button class="tab-btn" onclick="showTab('dungeon')">üè∞ Dungeon Layout</button>
            <button class="tab-btn" onclick="showTab('encounters')">‚öîÔ∏è All Encounters</button>
            <button class="tab-btn" onclick="showTab('treasures')">üíé All Treasures</button>
            <button class="tab-btn" onclick="showTab('events')">üé≠ All Events</button>
            <button class="tab-btn" onclick="showTab('evolution')">üå± Evolution Path</button>
        </div>

        <div id="hero-tab" class="tab-content active">
            <h2>üë§ Hero Details</h2>
            <div id="hero-details"></div>
        </div>

        <div id="dungeon-tab" class="tab-content">
            <h2>üè∞ Dungeon Layout</h2>
            <div id="dungeon-layout"></div>
        </div>

        <div id="encounters-tab" class="tab-content">
            <h2>‚öîÔ∏è All Encounters</h2>
            <input type="text" class="search-box" placeholder="Search encounters..." onkeyup="filterEncounters(this.value)">
            <div id="encounters-list"></div>
        </div>

        <div id="treasures-tab" class="tab-content">
            <h2>üíé All Treasures</h2>
            <input type="text" class="search-box" placeholder="Search treasures..." onkeyup="filterTreasures(this.value)">
            <div id="treasures-list"></div>
        </div>

        <div id="events-tab" class="tab-content">
            <h2>üé≠ All Events</h2>
            <div id="events-list"></div>
        </div>

        <div id="evolution-tab" class="tab-content">
            <h2>üå± Evolution Path</h2>
            <div id="evolution-timeline"></div>
        </div>
    </div>

    <script>
        // Simple seeded random number generator
        function seedRandom(seed) {
            let m = 2 ** 35 - 31;
            let a = 185852;
            let s = seed % m;

            return function () {
                return (s = (s * a) % m) / m;
            };
        }

        // Generator utilities
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function pick(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function weightedPick(items) {
            const total = items.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * total;

            for (const item of items) {
                if (random < item.weight) return item.item;
                random -= item.weight;
            }

            return items[items.length - 1].item;
        }

        function scaleValue(base, level, scaleFactor = 0.12) {
            return Math.max(1, Math.round(base * (1 + level * scaleFactor)));
        }

        // Embedded fallback data to avoid CORS issues
        const heroesData = [
            { id: 'warrior', name: 'Warrior', class: 'warrior', base: { hp: 100, atk: 20, def: 15, spd: 10 }, element_affinity: ['earth'], starting_deck: [] },
            { id: 'mage', name: 'Mage', class: 'mage', base: { hp: 80, atk: 25, def: 10, spd: 15 }, element_affinity: ['fire'], starting_deck: [] },
            { id: 'rogue', name: 'Rogue', class: 'rogue', base: { hp: 90, atk: 22, def: 12, spd: 20 }, element_affinity: ['air'], starting_deck: [] },
            { id: 'cleric', name: 'Cleric', class: 'cleric', base: { hp: 110, atk: 15, def: 20, spd: 8 }, element_affinity: ['water'], starting_deck: [] }
        ];

        const monstersData = [
            { id: 'goblin', name: 'Goblin', level: 1, element: 'earth', base: { hp: 30, atk: 8, def: 5, spd: 12 }, loot_table: [] },
            { id: 'skeleton', name: 'Skeleton', level: 2, element: 'earth', base: { hp: 40, atk: 10, def: 8, spd: 10 }, loot_table: [] },
            { id: 'orc', name: 'Orc', level: 3, element: 'earth', base: { hp: 60, atk: 15, def: 12, spd: 8 }, loot_table: [] },
            { id: 'fire_elemental', name: 'Fire Elemental', level: 4, element: 'fire', base: { hp: 50, atk: 20, def: 6, spd: 15 }, loot_table: [] },
            { id: 'ice_elemental', name: 'Ice Elemental', level: 4, element: 'water', base: { hp: 55, atk: 18, def: 10, spd: 12 }, loot_table: [] },
            { id: 'shadow_assassin', name: 'Shadow Assassin', level: 5, element: 'air', base: { hp: 45, atk: 25, def: 8, spd: 20 }, loot_table: [] }
        ];

        const roomsData = [
            { type: 'battle', monsters: [{ id: 'goblin', count: 2 }] },
            { type: 'treasure', gold_range: [20, 100] },
            { type: 'rest', healing: 20 },
            { type: 'trap', damage: 15 },
            { type: 'event', tarot: 'The Fool' }
        ];

        const tarotData = [
            { id: 'Fool', name: 'The Fool', white_star_meaning: 'New beginnings, potential, evolutionary leap', effect: 'Gain new ability or card', rarity: 'common' },
            { id: 'Magician', name: 'The Magician', white_star_meaning: 'Manifestation, creative power, transformation', effect: 'Enhance existing abilities', rarity: 'common' },
            { id: 'Tower', name: 'The Tower', white_star_meaning: 'Awakening, breakthrough, sudden change', effect: 'Transform hero aspect', rarity: 'rare' },
            { id: 'Transition', name: 'The Transition', white_star_meaning: 'Shedding old skins, evolutionary leap', effect: 'Evolve card or hero', rarity: 'epic' }
        ];

        // Initialize data (no external loading needed)
        async function initData() {
            console.log('üì¶ Using embedded fallback data');
        }

        let currentRunData = null;

        window.generateNewRun = function() {
            console.log('üé≠ Generating new run...');
            generateCompleteRun({
                totalFloors: 7,
                seed: Math.floor(Math.random() * 1000000)
            }).then(data => {
                currentRunData = data;
                updateDisplay();
            });
        };

        window.showTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        };

        window.toggleView = function(view) {
            const element = document.getElementById(view + '-details') || document.getElementById(view + '-list') || document.getElementById(view + '-layout') || document.getElementById(view + '-timeline');
            if (element) {
                element.classList.toggle('hidden');
            }
        };

        window.filterEncounters = function(query) {
            const encounters = document.querySelectorAll('#encounters-list .monster-card');
            encounters.forEach(card => {
                const name = card.querySelector('.card-title').textContent.toLowerCase();
                if (name.includes(query.toLowerCase())) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        };

        window.filterTreasures = function(query) {
            const treasures = document.querySelectorAll('#treasures-list .treasure-card');
            treasures.forEach(card => {
                const name = card.querySelector('.card-title').textContent.toLowerCase();
                if (name.includes(query.toLowerCase())) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        };

        // Main generation function (simplified version)
        async function generateCompleteRun({ totalFloors = 7, heroClass = null, seed = null } = {}) {
            // Set seed for reproducible generation
            if (seed) Math.random = seedRandom(seed);

            console.log(`üé≠ Generating complete run with ${totalFloors} floors...`);

            // Wait for data to load
            if (heroesData.length === 0) {
                await initData();
            }

            // Generate hero
            const hero = generateHeroWithSetup(heroClass);

            // Generate complete dungeon
            const dungeon = generateCompleteDungeon(totalFloors, hero);

            // Generate all encounters and loot
            const runData = {
                hero,
                dungeon,
                encounters: generateAllEncounters(dungeon, hero),
                treasures: generateAllTreasures(dungeon, hero),
                events: generateAllEvents(dungeon, hero),
                evolution: generateEvolutionPath(hero, dungeon)
            };

            console.log(`‚úÖ Complete run generated!`);
            console.log(`üìä Summary:`);
            console.log(`   Hero: ${hero.name} (${hero.class})`);
            console.log(`   Floors: ${totalFloors}`);
            console.log(`   Total Rooms: ${dungeon.allRooms.length}`);
            console.log(`   Total Monsters: ${dungeon.allMonsters.length}`);
            console.log(`   Total Treasures: ${dungeon.allTreasures.length}`);

            return runData;
        }

        function generateHeroWithSetup(heroClass) {
            let template;
            if (heroClass && heroesData.find(h => h.id === heroClass)) {
                template = heroesData.find(h => h.id === heroClass);
            } else {
                template = pick(heroesData);
            }

            const level = 1;
            const scaledStats = {
                hp: scaleValue(template.base.hp, level, 0.1),
                atk: scaleValue(template.base.atk, level, 0.08),
                def: scaleValue(template.base.def, level, 0.06),
                spd: template.base.spd
            };

            const elementAffinity = pick(template.element_affinity || ['fire']);
            const tarotDestiny = pick(['The Fool', 'The Magician', 'The Tower']);

            return {
                id: template.id,
                name: template.name,
                class: template.class,
                level,
                elementAffinity,
                tarotDestiny,
                stats: scaledStats,
                maxStats: { ...scaledStats },
                currentStats: { ...scaledStats },
                deck: template.starting_deck || [],
                energy: 3,
                maxEnergy: 3,
                equipment: { weapon: null, relic: null, armor: null }
            };
        }

        function generateCompleteDungeon(totalFloors, hero) {
            const floors = [];
            const allRooms = [];
            const allMonsters = [];
            const allTreasures = [];

            for (let floor = 1; floor <= totalFloors; floor++) {
                const floorData = generateFloor(floor, hero);
                floors.push(floorData);
                allRooms.push(...floorData.rooms);
                allMonsters.push(...floorData.monsters);
                allTreasures.push(...floorData.treasures);
            }

            return {
                floors,
                allRooms,
                allMonsters,
                allTreasures,
                totalFloors,
                layout: generateDungeonLayout(allRooms)
            };
        }

        function generateFloor(floorLevel, hero) {
            const roomCount = Math.min(8 + floorLevel, 15);
            const rooms = [];

            for (let i = 0; i < roomCount; i++) {
                const roomTypes = ['battle', 'treasure', 'trap', 'rest', 'event'];
                const type = pick(roomTypes);

                const room = {
                    id: `room_${floorLevel}_${i}`,
                    type,
                    level: floorLevel,
                    monsters: type === 'battle' ? generateRoomMonsters(type, floorLevel) : [],
                    treasure: type === 'treasure' ? generateTreasure(floorLevel) : null,
                    tarot: pick(['The Fool', 'The Magician', 'The Tower']),
                    exits: []
                };

                rooms.push(room);
            }

            // Generate monsters and treasures for this floor
            const monsters = [];
            const treasures = [];

            rooms.forEach((room, index) => {
                if (room.monsters && room.monsters.length > 0) {
                    room.monsters.forEach(monster => {
                        monsters.push({
                            id: monster.id,
                            floor: floorLevel,
                            roomIndex: index,
                            monster: monster
                        });
                    });
                }

                if (room.treasure) {
                    treasures.push({
                        id: `treasure_${floorLevel}_${index}`,
                        floor: floorLevel,
                        roomIndex: index,
                        contents: room.treasure,
                        roomType: room.type
                    });
                }
            });

            return {
                level: floorLevel,
                rooms,
                monsters,
                treasures
            };
        }

        function generateRoomMonsters(roomType, level) {
            if (roomType !== 'battle') return [];

            const monsterCount = randInt(1, 3);
            const monsters = [];

            for (let i = 0; i < monsterCount; i++) {
                const template = pick(monstersData);
                const monster = {
                    id: template.id,
                    name: template.name,
                    level,
                    element: template.element,
                    tarot: template.tarot || 'The Fool',
                    stats: {
                        hp: scaleValue(template.base.hp, level, 0.15),
                        atk: scaleValue(template.base.atk, level, 0.12),
                        def: scaleValue(template.base.def, level, 0.08),
                        spd: Math.max(1, template.base.spd + Math.floor(level / 3))
                    }
                };
                monsters.push(monster);
            }

            return monsters;
        }

        function generateTreasure(level) {
            const treasureTypes = ['gold', 'weapon', 'relic'];
            const type = pick(treasureTypes);

            if (type === 'gold') {
                const amount = randInt(20, 100) + level * 10;
                return [{ type: 'gold', amount }];
            } else {
                return [{ type, id: type + '_basic', name: type + ' item' }];
            }
        }

        function generateAllEncounters(dungeon, hero) {
            return dungeon.allMonsters.map(monsterData => ({
                id: `encounter_${monsterData.id}`,
                floor: monsterData.floor,
                roomIndex: monsterData.roomIndex,
                type: 'combat',
                monster: monsterData.monster,
                difficulty: calculateEncounterDifficulty(monsterData.monster, hero),
                potentialLoot: [],
                tarotInfluence: monsterData.monster.tarot
            }));
        }

        function generateAllTreasures(dungeon, hero) {
            return dungeon.allTreasures.map(treasureData => ({
                id: treasureData.id,
                floor: treasureData.floor,
                roomIndex: treasureData.roomIndex,
                type: treasureData.roomType,
                contents: treasureData.contents,
                value: calculateTreasureValue(treasureData.contents),
                rarity: 'common'
            }));
        }

        function generateAllEvents(dungeon, hero) {
            return dungeon.allRooms.filter(room => room.type === 'event').map(room => ({
                id: `event_${room.id}`,
                floor: Math.floor(dungeon.allRooms.indexOf(room) / 8) + 1,
                roomIndex: dungeon.allRooms.indexOf(room) % 8,
                type: 'tarot_event',
                tarotCard: room.tarot,
                choices: [
                    { text: "Embrace the lesson", effect: "positive", value: 2 },
                    { text: "Seek deeper understanding", effect: "evolution", value: 1 }
                ],
                outcomes: {
                    positive: `Gain insight into ${room.tarot} teachings`,
                    evolution: `Transform understanding of ${room.tarot}`
                }
            }));
        }

        function generateEvolutionPath(hero, dungeon) {
            return {
                startingState: {
                    stats: { ...hero.stats },
                    deck: [...hero.deck],
                    equipment: { ...hero.equipment }
                },
                milestones: [],
                finalState: null
            };
        }

        function generateDungeonLayout(rooms) {
            return {
                width: 20,
                height: 20,
                rooms: rooms.map((room, index) => ({
                    id: room.id,
                    x: (index % 5) * 4,
                    y: Math.floor(index / 5) * 4,
                    type: room.type,
                    tarot: room.tarot
                })),
                paths: []
            };
        }

        function calculateEncounterDifficulty(monster, hero) {
            const monsterPower = monster.stats.hp + monster.stats.atk + monster.stats.def;
            const heroPower = hero.stats.hp + hero.stats.atk + hero.stats.def;
            const ratio = monsterPower / heroPower;

            if (ratio < 0.8) return 'easy';
            if (ratio < 1.2) return 'medium';
            if (ratio < 1.8) return 'hard';
            return 'deadly';
        }

        function calculateTreasureValue(contents) {
            return contents.reduce((total, item) => {
                if (item.type === 'gold') return total + item.amount;
                return total + 50;
            }, 0);
        }

        function updateDisplay() {
            if (!currentRunData) return;

            // Update summary
            document.getElementById('hero-name').textContent = currentRunData.hero.name;
            document.getElementById('total-floors').textContent = currentRunData.dungeon.totalFloors;
            document.getElementById('total-rooms').textContent = currentRunData.dungeon.allRooms.length;
            document.getElementById('total-monsters').textContent = currentRunData.dungeon.allMonsters.length;
            document.getElementById('total-treasures').textContent = currentRunData.dungeon.allTreasures.length;

            // Update hero details
            updateHeroDetails();

            // Update dungeon layout
            updateDungeonLayout();

            // Update encounters
            updateEncounters();

            // Update treasures
            updateTreasures();

            // Update events
            updateEvents();

            // Update evolution
            updateEvolution();
        }

        function updateHeroDetails() {
            const hero = currentRunData.hero;
            const container = document.getElementById('hero-details');

            container.innerHTML = `
                <div class="hero-card">
                    <div class="card-header">
                        <span class="card-title">${hero.name} the ${hero.class}</span>
                        <span class="card-badge">Level ${hero.level}</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">${hero.stats.hp}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Attack</div>
                            <div class="stat-value">${hero.stats.atk}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Defense</div>
                            <div class="stat-value">${hero.stats.def}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">${hero.stats.spd}</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <strong>Elemental Affinity:</strong> ${hero.elementAffinity}<br>
                        <strong>Tarot Destiny:</strong> ${hero.tarotDestiny}<br>
                        <strong>Starting Deck:</strong> ${hero.deck.length} cards<br>
                        <strong>Energy:</strong> ${hero.energy}/${hero.maxEnergy}
                    </div>
                </div>
            `;
        }

        function updateDungeonLayout() {
            const container = document.getElementById('dungeon-layout');
            const floors = currentRunData.dungeon.floors;

            container.innerHTML = `
                <div class="floor-grid">
                    ${floors.map(floor => `
                        <div class="floor-card">
                            <h3>Floor ${floor.level}</h3>
                            <div class="room-grid">
                                ${floor.rooms.map(room => `
                                    <div class="mini-room">
                                        <div><strong>${room.type}</strong></div>
                                        <div>${room.tarot}</div>
                                        <div>${room.monsters ? room.monsters.length : 0} monsters</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateEncounters() {
            const container = document.getElementById('encounters-list');
            const encounters = currentRunData.encounters.slice(0, 20); // Limit for display

            container.innerHTML = encounters.map(encounter => `
                <div class="monster-card">
                    <div class="card-header">
                        <span class="card-title">${encounter.monster.name}</span>
                        <span class="card-badge">${encounter.difficulty.toUpperCase()}</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">${encounter.monster.stats.hp}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Attack</div>
                            <div class="stat-value">${encounter.monster.stats.atk}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Defense</div>
                            <div class="stat-value">${encounter.monster.stats.def}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">${encounter.monster.stats.spd}</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Element:</strong> ${encounter.monster.element} |
                        <strong>Tarot:</strong> ${encounter.monster.tarot} |
                        <strong>Floor:</strong> ${encounter.floor}
                    </div>
                </div>
            `).join('');
        }

        function updateTreasures() {
            const container = document.getElementById('treasures-list');
            const treasures = currentRunData.treasures.slice(0, 15); // Limit for display

            container.innerHTML = treasures.map(treasure => `
                <div class="treasure-card">
                    <div class="card-header">
                        <span class="card-title">${treasure.type} Treasure</span>
                        <span class="card-badge">${treasure.rarity.toUpperCase()}</span>
                    </div>
                    <div><strong>Floor ${treasure.floor} - Value: ${treasure.value}g</strong></div>
                    <div class="loot-list">
                        ${treasure.contents.map(item => `
                            <div class="loot-item">
                                <span class="loot-name">${item.name || item.type}</span>
                                <span class="loot-value">${item.amount || 'Item'}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function updateEvents() {
            const container = document.getElementById('events-list');
            const events = currentRunData.events.slice(0, 10); // Limit for display

            container.innerHTML = events.map(event => `
                <div class="room-card">
                    <div class="card-header">
                        <span class="card-title">Tarot Event: ${event.tarotCard}</span>
                        <span class="card-badge">Floor ${event.floor}</span>
                    </div>
                    <div><strong>Type:</strong> ${event.type}</div>
                    <div><strong>Choices:</strong></div>
                    <ul>
                        ${event.choices.map(choice => `<li>${choice.text} (${choice.effect})</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function updateEvolution() {
            const container = document.getElementById('evolution-timeline');
            const evolution = currentRunData.evolution;

            container.innerHTML = `
                <div class="evolution-timeline">
                    <h3>Starting State</h3>
                    <div class="timeline-item">
                        <strong>Initial Stats:</strong> HP:${evolution.startingState.stats.hp} ATK:${evolution.startingState.stats.atk} DEF:${evolution.startingState.stats.def}
                    </div>

                    <div class="timeline-item">
                        <h4>Evolution Journey</h4>
                        <div>The hero's complete transformation journey through all floors</div>
                    </div>
                </div>
            `;
        }

        // Initialize and generate first run
        initData().then(() => {
            generateNewRun();
        });
    </script>
</body>
</html>
